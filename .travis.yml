sudo: required
services:
  - docker

before_install:
  - docker build -t taylorzh/client-react -f ./client-react/Dockerfile.dev ./client-react
  - docker build -t taylorzh/client-flask -f ./client-flask/Dockerfile.dev ./client-flask
  - docker build -t taylorzh/server-gin -f ./server-gin/Dockerfile.dev ./server-gin

script:
  - docker run -e CI=true taylorzh/client-react npm test
  - docker run taylorzh/client-flask pytest
  - docker run taylorzh/server-gin go test ./...

after_success:
  - docker build -t taylorzh/client-react ./client-react
  - docker build -t taylorzh/nginx ./nginx
  - docker build -t taylorzh/server-gin ./server-gin
  - docker build -t taylorzh/client-flask ./client-flask

# Log in to the docker CLI
  - echo "$DOCKER_PWD" | docker login -u  "$DOCKER_ID" --password-stdin

# # Take those images and push them to DOCKER HUB
  - docker push taylorzh/client-react
  - docker push taylorzh/nginx
  - docker push taylorzh/server-gin
  - docker push taylorzh/client-flask

# deploy:
#   provider: elasticbeanstalk
#   region: "us-west-1"
#   app: "multi-docker"
#   env: "MultiDocker-env"
#   bucket_name: "elasticbeanstalk-us-west-1-167789202206"
#   bucket_path: "docker-multi"
#   access_key_id:
#     secure: "$AWS_ACCESS_KEY"
#   secret_access_key:
#     secure: "$AWS_SECRET_KEY"
#   on:
#     branch: master
